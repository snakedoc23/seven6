var directionsDisplay,directionsService,elevator,geocoder,snap,path=[],markers=[],drawChart=0,newRoute=0,startMarkerImage,finishMarkerImage,pointMarkerImage,infoBox,shadow,calculatedMarkers,chartMarker,polyline,map,route,distance=0,max_altitude=0,min_altitude=0,total_climb_up=0,total_climb_down=0,avg_speed=null,total_time_sec=0,colors=["#283A43","#c84446","#CACED0"],homeMarkers=[],homeInfoBoxes=[],sMarkerImageHover,sMarkerImage,newPhotoMarker,newPhotoInfoBox,photoMarker,photoMarkerImage,photoMarkerImageBlue,
photoMarkers=[],photoInfoBoxes=[],allPolylines=[],mc;google.load("visualization","1",{packages:["corechart"]});var mapWidth;
$(document).ready(function(){$("#show-workouts").click(function(){$("#route_actions a.selected").removeClass("selected");$("#show-workouts").addClass("selected");$("#comments-container").hide();$("#climbs-container").hide();$("#workouts-container").is(":visible")?($("#workouts-container").slideUp("slow"),$("#route_actions a.selected").removeClass("selected")):$("#workouts-container").slideDown("slow");return!1});$("#add_workout_btn").click(function(){$("#add_workout_btn").hide();$("#add-workout").slideDown("slow");
return!1});$("#workout_time_string").focus(function(){$("#workout_time_string").keyup(function(){var f=$("#workout_time_string").val();if(f.match(/\d{1,3}\D\d{1,2}\D?\d{0,2}/)==f){for(var a="",c=[],c=0;c<f.length;c++)var b=f.charAt(c),a=b.match(/\d/)?a+b:a+":";c=a.split(":");total_time_sec=0;""!=c[2]&&null!=c[2]?total_time_sec=3600*parseFloat(c[0])+60*parseFloat(c[1])+parseFloat(c[2]):(total_time_sec=3600*parseFloat(c[0])+60*parseFloat(c[1]),c[2]="0");0<total_time_sec&&(distance=$("#route_distance").val(),
avg_speed=Math.round(100*(3600*distance/total_time_sec))/100,$("#avg_speed_val").html(avg_speed),$("#total-time-show-h").html(c[0]),$("#total-time-show-m").html(c[1]),$("#total-time-show-s").html(c[2]));$("#error-explanation-time").hide();$("#workout_time_string").css("border-color","#D5D8D9")}else $("#error-explanation-time").show(),$("#workout_time_string").css("border-color","#C84446")})});$("#workout_time_string").blur(function(){""==$("#workout_time_string").val()&&($("#error-explanation-time").hide(),
$("#workout_time_string").css("border-color","#D5D8D9"))});$("#workout_pulse").blur(function(){var f=$("#workout_pulse").val(),a=f.match(/\d{2,3}\/\d{2,3}/);f==a||""==$("#workout_pulse").val()?($("#error-explanation-pulse").hide(),$("#workout_pulse").css("border-color","#D5D8D9")):($("#error-explanation-pulse").show(),$("#workout_pulse").css("border-color","#C84446"))});$("#workout_max_speed").blur(function(){var f=$("#workout_max_speed").val(),a=f.match(/\d{1,3}.?\d{0,4}/);(f==a||""==$("#workout_max_speed").val())&&
200>f?($("#error-explanation-max-speed").hide(),$("#workout_max_speed").css("border-color","#D5D8D9")):($("#error-explanation-max-speed").show(),$("#workout_max_speed").css("border-color","#C84446"))});$("#workout_temperature").blur(function(){var f=$("#workout_temperature").val(),a=f.match(/\d{1,2}.?\d{0,1}/);f==a||""==$("#workout_temperature").val()?($("#error-explanation-temperature").hide(),$("#workout_temperature").css("border-color","#D5D8D9")):($("#error-explanation-temperature").show(),$("#workout_temperature").css("border-color",
"#C84446"))});var a=$("#route_id").val();$("#workout_submit").click(function(){var f=$("#workout_time_string").val(),b=$("#workout_max_speed").val(),c=$("#workout_pulse").val(),d=$("#workout_temperature").val(),e=$("#workout_description").val();$.post("/create_workout",{route_id:a,time_string:f,max_speed:b,pulse:c,temperature:d,description:e},function(f){console.log(f);$("#workouts-list").append(f);updateWorkoutsNum(1)});$("#workout_time_string").val("");$("#workout_max_speed").val("");$("#workout_pulse").val("");
$("#workout_temperature").val("");$("#workout_description").val("");$("#add-workout").hide();$("#add_workout_btn").show();return!1});$("p.workout-meta .edit_workout").live("click",function(){var f=$(this).attr("id").split("_")[2],a=$(this).parent().parent().children("ul"),b=$(this);console.log(f);$.post("/edit_workout",{workout_id:f},function(d){a.html(d);b.hide();a.parent().children(".workout-description").remove();$("#workout_submit").click(function(){var b=$("#workout_time_string_edit").val(),
c=$("#workout_max_speed").val(),d=$("#workout_pulse_edit").val(),e=$("#workout_temperature").val(),g=$("#workout_description").val();$.post("/update_workout",{workout_id:f,time_string:b,max_speed:c,pulse:d,temperature:e,description:g},function(f){a.parent().parent().html(f)});return!1});$(".deleteWorkoutBtn").live("click",function(){$(".edit_workout").die();$(this).parent().parent().parent().parent().remove();$.post("/delete_workout",{workout_id:f},function(f){console.log(f);updateWorkoutsNum(-1)});
return!1})});"32 (32)".split("(")[1].replace(")","");return!1});var b=0,d="";$("#stats_next_btn").click(function(){b+=1;$.post("/show_stats",{user_id:e,period:d,offset:b},function(f){$("#script_chart").html(f)});return!1});$("#stats_previous_btn").click(function(){b-=1;$.post("/show_stats",{user_id:e,period:d,offset:b},function(f){$("#script_chart").html(f)});return!1});var e=$("#user_id").val();$("#charts_container").length&&($("#stats_day_btn").addClass("selected"),d="day",$.post("/show_stats",
{user_id:e,period:d,offset:b},function(f){$("#script_chart").html(f)}));$("#stats_day_btn").click(function(){$("#stats_actions a.selected").removeClass("selected");$("#stats_day_btn").addClass("selected");b=0;d="day";$.post("/show_stats",{user_id:e,period:d,offset:b},function(f){$("#script_chart").html(f)});return!1});$("#stats_month_btn").click(function(){$("#stats_actions a.selected").removeClass("selected");$("#stats_month_btn").addClass("selected");b=0;d="month";$.post("/show_stats",{user_id:e,
period:d,offset:b},function(f){$("#script_chart").html(f)});return!1});$("#stats_week_btn").click(function(){$("#stats_actions a.selected").removeClass("selected");$("#stats_week_btn").addClass("selected");b=0;d="week";$.post("/show_stats",{user_id:e,period:d,offset:b},function(f){$("#script_chart").html(f)});return!1});$("#distance_slider").slider({range:!0,min:0,max:100,values:[0,100],slide:function(f,a){100==a.values[1]?$("#distance_range").text(a.values[0]+" km - "+a.values[1]+"+ km"):$("#distance_range").text(a.values[0]+
" km - "+a.values[1]+" km")}});$("#distance_min").val()&&$("#distance_slider").slider("option","values",[$("#distance_min").val(),$("#distance_max").val()]);"100"==$("#distance_slider").slider("values",1)?$("#distance_range").text($("#distance_slider").slider("values",0)+" km - "+$("#distance_slider").slider("values",1)+"+ km"):$("#distance_range").text($("#distance_slider").slider("values",0)+" km - "+$("#distance_slider").slider("values",1)+" km");$("#altitude_slider").slider({range:!0,min:0,max:400,
values:[0,400],slide:function(a,b){400==b.values[1]?$("#altitude_range").text(b.values[0]+" m - "+b.values[1]+"+ m"):$("#altitude_range").text(b.values[0]+" m - "+b.values[1]+" m")}});$("#altitude_min").val()&&$("#altitude_slider").slider("option","values",[$("#altitude_min").val(),$("#altitude_max").val()]);"400"==$("#altitude_slider").slider("values",1)?$("#altitude_range").text($("#altitude_slider").slider("values",0)+" m - "+$("#altitude_slider").slider("values",1)+"+ m"):$("#altitude_range").text($("#altitude_slider").slider("values",
0)+" m - "+$("#altitude_slider").slider("values",1)+" m");$("#routes_filter_reset").click(function(){$("#altitude_slider").slider("option","values",[0,400]);$("#distance_slider").slider("option","values",[0,100]);$("#route_road").attr("checked",!1);return!1});1==$("#road").val()&&$("#route_road").attr("checked",!0);$("#routes_filter_btn").click(function(){var a=$(this).attr("href"),b=a.split("?")[1].split("&"),a=a.split("?")[0]+"?",c;for(c in b)a=-1!=b[c].indexOf("distance_max")?a+("distance_max="+
$("#distance_slider").slider("values",1)+"&"):-1!=b[c].indexOf("distance_min")?a+("distance_min="+$("#distance_slider").slider("values",0)+"&"):-1!=b[c].indexOf("altitude_max")?a+("altitude_max="+$("#altitude_slider").slider("values",1)+"&"):-1!=b[c].indexOf("altitude_min")?a+("altitude_min="+$("#altitude_slider").slider("values",0)+"&"):a+(b[c]+"&");a=$("#route_road").attr("checked")?a+"road=1":a+"road=0";console.log(a);$(this).attr("href",a)});var g=$("#route_rating_value").val();update_rating(g,
"#rating li a");a=$("#route_id").val();$("#rating li a").mouseover(function(){var a=$(this).html();$("#rating li a:lt("+a+")").addClass("select")});$("#rating li a").mouseout(function(){var a=$(this).html();$("#rating li a:lt("+a+")").removeClass("select")});$("#rating li a").click(function(){var b=$("#user_rating_value").val();$("#rating li a:lt("+b+")").addClass("select");b=parseFloat($(this).html());$.post("/add_rating",{route_id:a,value:b},function(a){update_rating(a,"#rating li a")});return!1});
$("#user_rating_value")&&(g=$("#user_rating_value").val(),$("#rating li a:lt("+g+")").addClass("select"));"true"==$("#user_rating_like").val()&&($("#add-favorite span").html("Usu\u0144 z ulubionych"),$("#add-favorite a").addClass("liked"));var h=$("#user_rating_like").val();$("#add-favorite a").click(function(){(h=$("#user_rating_like").val())?(h=null,$("#add-favorite span").html("Dodaj do ulubionych"),$("#add-favorite a").removeClass("liked")):(h=!0,$("#add-favorite span").html("Usu\u0144 z ulubionych"),
$("#add-favorite a").addClass("liked"));$("#user_rating_like").val(h);$.post("/add_like",{route_id:a,like:h},function(){});return!1});update_index_rating();$("#avatar_actions_update").bind("click",function(){$("#avatar_form").is(":visible")?$("#avatar_form").slideUp("slow"):$("#avatar_form").slideDown("slow");return!1});$("#show-comments").click(function(){$("#route_actions a.selected").removeClass("selected");$("#show-comments").addClass("selected");$("#climbs-container").slideUp();$("#workouts-container").slideUp();
$("#comments-container").is(":visible")?($("#comments-container").slideUp("slow"),$("#route_actions a.selected").removeClass("selected")):$("#comments-container").slideDown("slow");return!1});$("p.comment-meta a.edit_comment").live("click",function(){var a=$(this).attr("id").split("_")[1];console.log(a);$(this).css("display","none");var b=$(this).parent().parent().children(),c=$(b[1]).html();console.log(c);$(b[1]).html("<a href='#' class='deleteCommentBtn'>Usu\u0144 komentarz</a><textarea id='newCommentContent'>"+
c+"</textarea><a href='#' class='editCommentBtn'>Zapisz</a>");$(".editCommentBtn").live("click",function(){$(".editCommentBtn").die();var c=$("#newCommentContent").val();$(b[1]).html(c);$.post("/edit_comment",{comment_id:a,content:c},function(a){console.log(a)});console.log("zmien id:"+a+" content:"+c);$("#edit_"+a).css("display","inline");return!1});$(".deleteCommentBtn").live("click",function(){$(".editCommentBtn").die();$(this).parent().parent().parent().remove();$.post("/delete_comment",{comment_id:a},
function(a){console.log(a);updateCommentsNum(-1)});return!1});return!1});a=$("#route_id").val();$("#add-comment-btn").click(function(){var b=$("#comment_content").val();$.post("/create_comment",{route_id:a,content:b},function(a){$("#comments-list").append(a);updateCommentsNum(1)});$("#comment_content").val("");return!1});$("#show-climbs").click(function(){$("#route_actions a.selected").removeClass("selected");$("#show-climbs").addClass("selected");$("#comments-container").hide();$("#workouts-container").hide();
if($("#climbs-container").is(":visible"))$("#climbs-container").slideUp("slow"),$("#route_actions a.selected").removeClass("selected"),$("#elevation-chart").slideUp();else if($("#climbs-container").slideDown("slow"),!$("#elevation-chart").is(":visible")){$("#elevation-chart").slideDown();$("#elevation-chart").width(mapWidth-1);if(190<path.length){for(var a=new google.maps.MVCArray,a=path;190<a.length;)a=reductionPath(a);console.log("Do wywalenia: "+(path.length-190));console.log(a.length)}a?(createElevation(a),
console.log("reduced")):createElevation(path)}return!1});$("#route_photos").length&&(a=$("#route_id").val(),$.ajax({type:"POST",url:"/photo_markers",data:{route_id:a},dataType:"json",success:function(a){console.log(a);for(var b=0;b<a.length;b++){var c=a[b][0].toString(),d=a[b][1].split(","),e=parseFloat(d[0]),d=parseFloat(d[1]),e=new google.maps.LatLng(e,d);createPhotoMarker(e,c)}}}));$("#add-photo").click(function(){photoMarkerImageBlue=new google.maps.MarkerImage("../images/markers_p_b.png",new google.maps.Size(34,
49),new google.maps.Point(0,0));for(var a=0;a<photoInfoBoxes.length;a++)photoInfoBoxes[a].close();for(a=0;a<photoMarkers.length;a++)photoMarkers[a].setIcon(photoMarkerImage);google.maps.event.addListenerOnce(map,"click",function(a){var b=a.latLng;newPhotoMarker=new google.maps.Marker({position:b,icon:photoMarkerImageBlue,map:map,draggable:!0,title:"Dodaj zdj\u0119cie"});$.post("/new_photo",{},function(a){var f=document.createElement("div");f.id="infobox_add_photo";f.innerHTML=a;a={content:f,disableAutoPan:!1,
maxWidth:0,pixelOffset:new google.maps.Size(-141,5),zIndex:null,boxStyle:{width:"260px"},closeBoxMargin:"5px",closeBoxURL:"../images/close.png",infoBoxClearance:new google.maps.Size(1,1),isHidden:!1,pane:"floatPane",enableEventPropagation:!1};newPhotoInfoBox=new InfoBox(a);newPhotoInfoBox.open(map,newPhotoMarker);google.maps.event.addListener(newPhotoInfoBox,"closeclick",function(){newPhotoMarker.setMap(null)});$("#new_photo").live("submit",function(){console.log("working");$("#photo_lat_lng").val(b.toUrlValue());
$("#photo_route_id").val($("#route_id").val())})})});return!1});$("#show_all_routes_btn").click(function(){if("Ukryj wszystkie trasy"==$("#show_all_routes_btn").text())clearAllUserRoutes();else{var a=$("#user_id").val();$.post("/show_all_routes",{user_id:a},function(a){for(var b=new google.maps.LatLngBounds,f=0;f<a.length;f++){var d=new google.maps.Polyline({strokeColor:"#283A43",strokeOpacity:0.6,strokeWeight:5,map:map}),e=[],g=pathFromString(a[f],e);d.setPath(e);allPolylines.push(d);addListenerToAllPolylines(d);
b.extend(g.getNorthEast());b.extend(g.getSouthWest())}map.fitBounds(b)});$("#show_all_routes_btn").text("Ukryj wszystkie trasy")}return!1});$("body").ajaxStart(function(){$("#ajax-status").show().text("\u0141adowanie...")});$("body").ajaxStop(function(){$("#ajax-status").fadeOut()});mapWidth=$(document).width()-$("#aside").outerWidth();$("#map").width(mapWidth);$("#map").height($(window).height()-63);$("#aside").css("min-height",$(window).height()-63);$("#map").height()<$("#aside").height()&&$("#map").height($("#aside").height());
$("#aside").resize(function(){$("#map").height()<$("#aside").height()&&$("#map").height($("#aside").height())});$(window).resize(function(){$("#map").width($(window).width()-$("#aside").outerWidth());$("#map").height($(window).height()-63);$("#aside").css("min-height",$(window).height()-63);$("#map").height()<$("#aside").height()&&$("#map").height($("#aside").height())});$(".flash").click(function(){$(".flash").slideUp("slow")});$("#error_explanation_route").click(function(){$("#error_explanation_route").slideUp("slow")});
$(".flash").delay(5E3).slideUp("slow");$(".pagination").length&&$(".pagination").width(150+29*($(".pagination").children().length-2));$("#map").length&&(map=initializeMap(),polyline=new google.maps.Polyline({strokeColor:"#c84446",strokeOpacity:0.8,strokeWeight:5,map:map}),snap=0,directionsService=new google.maps.DirectionsService,directionsDisplay=new google.maps.DirectionsRenderer,elevator=new google.maps.ElevationService,geocoder=new google.maps.Geocoder);$("#search-place").submit(function(){var a=
$("#search-place-text").val();centerMap(a);$("#search-place-text").val("");return!1});$("#last-routes").length&&loadStartMarkers(0,"added");$("#user-last-routes").length&&(e=$("#user_id").val(),loadStartMarkers(e,"added"));$("#last_routes_added_btn").bind("click",function(){var a=$("#user_id").val();loadStartMarkers(a,"added");loadLastRoutes("added",a);$("#last_routes_tabs li a.selected").removeClass("selected");$("#last_routes_added_btn").addClass("selected");return!1});$("#last_routes_favorite_btn").bind("click",
function(){loadStartMarkers(e,"favorite");loadLastRoutes("favorite",e);$("#last_routes_tabs li a.selected").removeClass("selected");$("#last_routes_favorite_btn").addClass("selected");return!1});$("#last_routes_following_btn").bind("click",function(){loadStartMarkers(e,"following");loadLastRoutes("following",e);$("#last_routes_tabs li a.selected").removeClass("selected");$("#last_routes_following_btn").addClass("selected");return!1});$(".routes-list").length&&($(".route-img").live("click",function(){$(".route-img").hasClass("selected")&&
$(".route-img").removeClass("selected");$(this).addClass("selected");var a=$(this).parent().attr("id").split("-")[2];clearAllUserRoutes();loadRouteToHome(a);for(var b=0;b<homeMarkers.length;b++)homeMarkers[b].setIcon(sMarkerImage),homeMarkers[b].getTitle()==a&&(homeMarkers[b].setIcon(sMarkerImageHover),homeInfoBoxes[b].open(map,homeMarkers[b]))}),$(".route-img").live("mouseover",function(){for(var a=$(this).parent().attr("id").split("-")[2],b=0;b<homeMarkers.length;b++)homeMarkers[b].setIcon(sMarkerImage),
homeMarkers[b].getTitle()==a&&(homeMarkers[b].setIcon(sMarkerImageHover),homeInfoBoxes[b].open(map,homeMarkers[b]))}),$(".route-img").live("mouseout",function(){for(var a=$(this).parent().attr("id").split("-")[2],b=0;b<homeMarkers.length;b++)homeMarkers[b].setIcon(sMarkerImage),homeMarkers[b].getTitle()==a&&(homeMarkers[b].setIcon(sMarkerImage),homeInfoBoxes[b].close())}));$("#altitude").click(function(){$(".altitude-extra").is(":visible")?($(".altitude-extra").hide(),$("#altitude .small-arrow").css("backgroundPosition",
"0"),$("#altitude").css("border-top","1px solid "+colors[2])):($(".altitude-extra").show(),$("#altitude .small-arrow").css("backgroundPosition","-13px"),$("#altitude").css("border-top","1px solid "+colors[0]))});$("#load_coordinates").length&&(drawChart=1,g=$("#load_coordinates").val(),$.post("/load_coordinates",{id:g},function(a){a=pathFromString(a,path);map.fitBounds(a);polyline.setPath(path);var a=path[0],b=path[path.length-1];startMarkerImage=new google.maps.MarkerImage("../images/markers.png",
new google.maps.Size(15,27),new google.maps.Point(0,0),new google.maps.Point(7.5,26));finishMarkerImage=new google.maps.MarkerImage("../images/markers.png",new google.maps.Size(15,27),new google.maps.Point(15,0),new google.maps.Point(7.5,26));new google.maps.Marker({position:a,map:map,title:"Pocz\u0105tek trasy",icon:startMarkerImage});new google.maps.Marker({position:b,map:map,title:"Koniec trasy",icon:finishMarkerImage});$("#show-elevation").click(function(){if($("#elevation-chart").is(":visible"))$("#elevation-chart").hide();
else{$("#elevation-chart").slideDown();$("#elevation-chart").width(mapWidth-1);if(190<path.length)for(var a=new google.maps.MVCArray,a=path;190<a.length;)a=reductionPath(a);a?createElevation(a):createElevation(path)}return!1})}));$("#route_time_string").focus(function(){$("#route_time_string").keyup(function(){var a=$("#route_time_string").val();if(a.match(/\d{1,3}\D\d{1,2}\D?\d{0,2}/)==a){for(var b="",c=[],c=0;c<a.length;c++)var d=a.charAt(c),b=d.match(/\d/)?b+d:b+":";c=b.split(":");total_time_sec=
0;""!=c[2]&&null!=c[2]?total_time_sec=3600*parseFloat(c[0])+60*parseFloat(c[1])+parseFloat(c[2]):(total_time_sec=3600*parseFloat(c[0])+60*parseFloat(c[1]),c[2]="0");0<total_time_sec&&(avg_speed=Math.round(100*(3600*distance/total_time_sec))/100,$("p.avg_speed .value").html(avg_speed),$("#total-time-show-h").html(c[0]),$("#total-time-show-m").html(c[1]),$("#total-time-show-s").html(c[2]));$("#error-explanation-time").hide();$("#route_time_string").css("border-color","#D5D8D9")}else $("#error-explanation-time").show(),
$("#route_time_string").css("border-color","#C84446")})});$("#route_time_string").blur(function(){""==$("#route_time_string").val()&&($("#error-explanation-time").hide(),$("#route_time_string").css("border-color","#D5D8D9"))});$("#route_pulse").blur(function(){var a=$("#route_pulse").val(),b=a.match(/\d{2,3}\/\d{2,3}/);a==b||""==$("#route_pulse").val()?($("#error-explanation-pulse").hide(),$("#route_pulse").css("border-color","#D5D8D9")):($("#error-explanation-pulse").show(),$("#route_pulse").css("border-color",
"#C84446"))});$("#route_max_speed").blur(function(){var a=$("#route_max_speed").val(),b=a.match(/\d{1,3}.?\d{0,4}/);(a==b||""==$("#route_max_speed").val())&&200>a?($("#error-explanation-max-speed").hide(),$("#route_max_speed").css("border-color","#D5D8D9")):($("#error-explanation-max-speed").show(),$("#route_max_speed").css("border-color","#C84446"))});$("#route-new-extra").hide();$("#show-extra").click(function(){$("#route-new-extra").slideToggle("slow",function(){"Poka\u017c dodatkowe opcje"==$("#show-extra").html()?
$("#show-extra").html("Ukryj dodatkowe opcje"):$("#show-extra").html("Poka\u017c dodatkowe opcje")});return!1});$("#upload-file-btn").bind("click",function(){$("#draw-controls").is(":visible")&&$("#draw-controls").slideUp("slow");$("#upload-form").is(":visible")?$("#upload-form").slideUp("slow"):$("#upload-form").slideDown("slow");return!1});if($("#route_coordinates_string").val()){g=pathFromString($("#route_coordinates_string").val(),path);map.fitBounds(g);polyline.setPath(path);addDistanceToPage(polyline);
if(190<path.length)for(var i=new google.maps.MVCArray,i=path;190<i.length;)i=reductionPath(i);i?createElevation(i):createElevation(path)}$("#draw-controls").hide();$("#draw-route-btn").bind("click",function(){$("#upload-form").is(":visible")&&$("#upload-form").slideUp("slow");$("#draw-controls").is(":visible")?$("#draw-controls").slideUp("slow"):($("#draw-controls").slideDown("slow"),null==route&&(route=drawRoute(map,polyline)));return!1});$("#delete-path").bind("click",function(){deletePath(path);
return!1});$("#snap").click(function(a){a.preventDefault();0===snap?(snap=1,$("#snap").css("color","#283A43"),$("#snap").text("Wy\u0142\u0105cz przyci\u0105ganie")):(snap=0,$("#snap").css("color","#C84446"),$("#snap").text("Przyci\u0105gaj do dr\u00f3g"))});$("#route_submit").click(function(){newRoute=1;if(1<path.length){if(190<path.length)for(var a=new google.maps.MVCArray,a=path;190<a.length;)a=reductionPath(a);a?createElevation(a):createElevation(path)}return!1});$("#edit-route").click(function(){for(var a=
$("#route_time_string_edit").val(),b="",c=[],c=0;c<a.length;c++){var d=a.charAt(c);d.match(/\d/)?b+=d:d.match(/\s/)||(b+=":")}c=b.split(":");total_time_sec=0;""!=c[2]&&null!=c[2]?total_time_sec=3600*parseFloat(c[0])+60*parseFloat(c[1])+parseFloat(c[2]):(total_time_sec=3600*parseFloat(c[0])+60*parseFloat(c[1]),c[2]="0");distance=$("#route_distance").val();avg_speed=Math.round(100*(3600*distance/total_time_sec))/100;a=$("#route_pulse_edit").val();"0/0"==a&&(a=null);$("#route_total_time").val(total_time_sec);
$("#route_pulse").val(a);$("#route_avg_speed").val(avg_speed)})});
function createPhotoMarker(a,b){photoMarkerImage=new google.maps.MarkerImage("../images/markers_p.png",new google.maps.Size(34,49),new google.maps.Point(0,0));photoMarkerImageBlue=new google.maps.MarkerImage("../images/markers_p_b.png",new google.maps.Size(34,49),new google.maps.Point(0,0));photoMarker=new google.maps.Marker({position:a,icon:photoMarkerImage,map:map,title:b});photoMarkers.push(photoMarker);addListenersToPhotoMarker(photoMarker,b)}
function addListenersToPhotoMarker(a,b){google.maps.event.addListener(a,"click",function(){for(var d=0;d<photoMarkers.length;d++)photoMarkers[d].setIcon(photoMarkerImage);for(d=0;d<photoInfoBoxes.length;d++)photoInfoBoxes[d].close();a.setIcon(photoMarkerImageBlue);showPhoto(a,b)})}
function showPhoto(a,b){$.post("/show_photo",{id:b},function(b){var e=document.createElement("div");e.id="infobox_show_photo";e.innerHTML=b;b={content:e,disableAutoPan:!1,maxWidth:0,pixelOffset:new google.maps.Size(-333,5),zIndex:null,boxStyle:{width:"666px"},closeBoxMargin:"5px",closeBoxURL:"../images/close.png",infoBoxClearance:new google.maps.Size(1,1),isHidden:!1,pane:"floatPane",enableEventPropagation:!0};b=new InfoBox(b);photoInfoBoxes.push(b);b.open(map,a);$(".fancybox").fancybox({type:"image",
padding:"5"});$("#infobox_show_photo").live("mouseover",function(){$("#infobox_show_photo").die();$("#photo_img").slides()});google.maps.event.addListener(b,"closeclick",function(){a.setIcon(photoMarkerImage)});newPhotoInfoBox&&(newPhotoInfoBox.close(),newPhotoMarker.setMap(null))})}function addListenerToAllPolylines(a){google.maps.event.addListener(a,"click",function(){for(var b=0;b<allPolylines.length;b++)homeInfoBoxes[b].close(),allPolylines[b]==a&&homeInfoBoxes[b].open(map,homeMarkers[b])})}
function clearAllUserRoutes(){for(var a=0;a<allPolylines.length;a++)homeInfoBoxes[a]&&homeInfoBoxes[a].close(),allPolylines[a].setMap(null);allPolylines=[];$("#show_all_routes_btn").text("Wszystkie trasy")}
function loadStartMarkers(a,b){for(var d=0;d<homeMarkers.length;d++)homeMarkers[d].setMap(null);homeInfoBoxes=[];homeMarkers=[];mc&&mc.clearMarkers();$.ajax({type:"POST",url:"/start_markers",data:{user_id:a,route_type:b},dataType:"json",success:function(a){for(var b=0;b<a.length;b++){var d=a[b][0].toString(),i=a[b][2].toString(),f=a[b][3].toString(),j=a[b][4].toString(),c=a[b][1].split(","),l=parseFloat(c[0]),c=parseFloat(c[1]),l=new google.maps.LatLng(l,c);createStartMarker(l,d,i,f,j)}mc=new MarkerClusterer(map,
homeMarkers,{gridSize:50,maxZoom:14,styles:[{url:"../images/cluster_1n.png",height:35,width:35,textColor:"white"},{url:"../images/cluster_2n.png",height:48,width:48,textColor:"white",textSize:13},{url:"../images/cluster_3n.png",height:56,width:56,textColor:"white",textSize:13}]})}})}function loadLastRoutes(a,b){$.post("/user_last_routes",{last_route_type:a,user_id:b},function(a){$("#last_route_container").html(a)})}
function createStartMarker(a,b,d,e,g){sMarkerImage=new google.maps.MarkerImage("../images/markers_h.png",new google.maps.Size(34,49),new google.maps.Point(0,0));sMarkerImageHover=new google.maps.MarkerImage("../images/markers_h.png",new google.maps.Size(34,49),new google.maps.Point(34,0));var a=new google.maps.Marker({position:a,icon:sMarkerImage,title:b}),b=a.getTitle(),h=document.createElement("div");h.id="infobox";h.innerHTML="<h3>"+d+"</h3><p>Dystans: <span>"+e+"km</span> Doda\u0142: <span>"+
g+"</span></p>";d={content:h,disableAutoPan:!1,maxWidth:0,pixelOffset:new google.maps.Size(-140,0),zIndex:null,boxStyle:{opacity:0.9,width:"280px"},closeBoxMargin:"10px 2px 2px 2px",infoBoxClearance:new google.maps.Size(1,1),isHidden:!1,pane:"floatPane",enableEventPropagation:!1};infoBox=new InfoBox(d);homeInfoBoxes.push(infoBox);homeMarkers.push(a);addListenersToMarker(a,infoBox,b)}
function addListenersToMarker(a,b,d){google.maps.event.addListener(a,"mouseover",function(){b.open(map,a)});google.maps.event.addListener(a,"mouseout",function(){b.close()});google.maps.event.addListener(a,"click",function(){for(var e=0;e<homeMarkers.length;e++)homeMarkers[e].setIcon(sMarkerImage);a.setIcon(sMarkerImageHover);loadRouteToHome(d);clearAllUserRoutes();$(".route-img").removeClass("selected");for(var g=$(".route-img"),e=0;e<g.length;e++){var h=$(g[e]).parent().attr("id").split("-")[2];
h==d&&$("#route-home-"+h+" > .route-img").addClass("selected")}b.open(map,a);google.maps.event.addListener(this,"click",function(){var b=a.getTitle();window.location="/routes/"+b})})}function loadRouteToHome(a){a=parseFloat(a);path=[];polyline.setPath(path);$.post("/load_coordinates",{id:a},function(a){a=pathFromString(a,path);map.fitBounds(a);polyline.setPath(path)});google.maps.event.addListener(map,"click",function(){path=[];polyline.setPath(path)})}
function pathToString(a){for(var a=route.getPath(),b="",d=0;d<a.b.length;d++){var e=a.getAt(d).toUrlValue();d<a.b.length-1&&(e+="|");b+=e}return b}function pathFromString(a,b){for(var d=new google.maps.LatLngBounds,e=a.split("|"),g=0;g<e.length;g++){var h=e[g].split(","),i=parseFloat(h[0]),h=parseFloat(h[1]),i=new google.maps.LatLng(i,h);b.push(i);d.extend(i)}return d}
function initializeMap(){return new google.maps.Map(document.getElementById("map"),{zoom:11,center:new google.maps.LatLng(50.263888,19.029007),mapTypeId:google.maps.MapTypeId.ROADMAP})}
function drawRoute(a,b){shadow=new google.maps.MarkerImage("../images/shadow.png",null,null,new google.maps.Point(8,2));startMarkerImage=new google.maps.MarkerImage("../images/markers.png",new google.maps.Size(15,27),new google.maps.Point(0,0),new google.maps.Point(7.5,26));pointMarkerImage=new google.maps.MarkerImage("../images/markers.png",new google.maps.Size(13,13),new google.maps.Point(30,0),new google.maps.Point(6.5,6.5));finishMarkerImage=new google.maps.MarkerImage("../images/markers.png",
new google.maps.Size(15,27),new google.maps.Point(15,0),new google.maps.Point(7.5,26));google.maps.event.addListener(a,"click",function(d){var d=d.latLng,e=new google.maps.Marker({position:d,map:a,draggable:!0,icon:pointMarkerImage,title:"Kliknij by usun\u0105\u0107 lub przesu\u0144"});if(1===snap)if(1>markers.length)setFirstMarker(e),markers.push(e),path.push(e.getPosition()),editMarkerC(e,b);else{var g=markers[markers.length-1].getPosition();calcRoute(g,d,e);e.setMap(null)}else 1>markers.length&&
setFirstMarker(e),markers.push(e),path.push(e.getPosition()),editMarker(e,b);b.setPath(path);addDistanceToPage(b)});return b}
function calcRoute(a,b){directionsService.route({origin:a,destination:b,travelMode:google.maps.TravelMode.DRIVING},function(a,b){if(b==google.maps.DirectionsStatus.OK){directionsDisplay.setDirections(a);for(var g=1;g<directionsDisplay.directions.routes[0].overview_path.length;g++){var h=directionsDisplay.directions.routes[0].overview_path[g];path.push(h);h=new google.maps.Marker({position:h});markers.push(h);calculatedMarkers=g;editMarkerC(h,polyline,calculatedMarkers)}markers[markers.length-1].setMap(map);
polyline.setPath(path);addDistanceToPage(polyline)}})}function editMarker(a,b){google.maps.event.addListener(a,"drag",function(){for(var d=0;d<markers.length;d++)if(markers[d]==a){b.getPath().setAt(d,a.getPosition());break}addDistanceToPage(b)});google.maps.event.addListener(a,"click",function(){for(var d=0;d<markers.length;d++)if(markers[d]==a){0==d&&setFirstMarker(markers[1]);a.setMap(null);markers.splice(d,1);b.getPath().removeAt(d);break}addDistanceToPage(b)});setLastMarker()}
function deletePath(){for(var a=0,b=0;b<markers.length;b++)polyline.getPath().pop(),markers[b].setMap(null),console.log("Usuwam: "+b),a++;markers=[]}function setFirstMarker(a){a.setIcon(startMarkerImage);a.setTitle("Pocz\u0105tek trasy")}function setLastMarker(){if(1<markers.length){markers[markers.length-2].getIcon()==finishMarkerImage&&markers[markers.length-2].setIcon(pointMarkerImage);var a=markers[markers.length-1];a.setIcon(finishMarkerImage);a.setTitle("Koniec trasy")}}
function editMarkerC(a,b,d){google.maps.event.addListener(a,"click",function(){for(var e=0;e<markers.length;e++)if(markers[e]==a){0==e&&setFirstMarker(markers[1]);for(var g=e-d,h=e;h>g;h--)markers[h].setMap(null),markers.splice(h,1),b.getPath().removeAt(h)}addDistanceToPage(b)});setLastMarker()}function calculateDistance(a){for(var b=a.getPath().getLength(),d=0,e=0;e<b-1;e++)d+=google.maps.geometry.spherical.computeDistanceBetween(a.getPath().getAt(e),a.getPath().getAt(e+1));return d}
function addDistanceToPage(a){distance=Math.round(100*(calculateDistance(a)/1E3))/100;$(".distance .value").html(distance);1<total_time_sec&&(avg_speed=Math.round(100*(3600*distance/total_time_sec))/100,$("p.avg_speed .value").html(avg_speed))}function reductionPath(a){var b=a.length,d=Math.ceil(b/(b-190));reucedPath=[];for(var e=0;e<b;e++)0!=(e+1)%d&&reucedPath.push(a[e]);return reucedPath}function createElevation(a){elevator.getElevationAlongPath({path:a,samples:512},plotElevation)}
function plotElevation(a,b){if(b==google.maps.ElevationStatus.OK){var d=Math.round(100*(calculateDistance(polyline)/1E3))/100,e=1E3*d/a.length;if(newRoute){for(var g=a[0].elevation,h=a[0].elevation,i=0,f=0,j=[],c=0;c<a.length;c++){if(0<c){if(1<c)var l=a[c-1].elevation-a[c-2].elevation;if(c<a.length-1)var m=a[c+1].elevation-a[c].elevation;if(0<a[c].elevation-a[c-1].elevation){if(1==c){var k={F:{position:Math.round(c*e),elevation:a[c].elevation}};j.push(k)}else 0>l&&(k={F:{position:Math.round(c*e),
elevation:a[c].elevation}},j.push(k));if(0>=m||c==a.length-1)k={position:Math.round(c*e),elevation:a[c].elevation},j[j.length-1].L=k}}k=a[c].elevation;k<g?g=k:k>h&&(h=k);0<c&&(k=a[c].elevation-a[c-1].elevation,0>k?f+=-1*k:i+=k)}max_altitude=h;min_altitude=g;total_climb_up=i;total_climb_down=f;g="";for(c=0;c<j.length;c++)h=j[c].L.elevation-j[c].F.elevation,i=j[c].L.position-j[c].F.position,f=100*h/i,30<h&&500<i&&1<f&&(""!=g&&(g+="|"),g+=j[c].F.position+","+j[c].F.elevation+","+j[c].L.position+","+
j[c].L.elevation);$("#route_climbs_string").val(g);$("#route_distance").val(d);$("#route_max_altitude").val(max_altitude);$("#route_min_altitude").val(min_altitude);$("#route_total_climb_up").val(total_climb_up);$("#route_total_climb_down").val(total_climb_down);$("#route_total_time").val(total_time_sec);$("#route_avg_speed").val(avg_speed);$("#route_coordinates_string").val()||(c=pathToString(path),$("#route_coordinates_string").val(c));$("#new_route").submit()}if(drawChart){d=new google.visualization.DataTable;
d.addColumn("string","D");d.addColumn("number","Wysoko\u015b\u0107");for(c=0;c<a.length;c++)d.addRow([(Math.round(c*e)/1E3).toString()+" km",Math.round(100*a[c].elevation)/100]);e=new google.visualization.AreaChart(document.getElementById("elevation-chart"));e.draw(d,{width:mapWidth,height:200,legend:"none",colors:["#283A43"],backgroundColor:"#f1f1f1",titleY:"Wysoko\u015b\u0107 (m)",titleX:"Dystans (km)",chartArea:{left:50,top:23,width:mapWidth,height:"157"},vAxis:{baselineColor:"#283a43"},fontSize:13,
fontName:"Helvetica Neue"});sMarkerImage=new google.maps.MarkerImage("../images/markers_e.png",new google.maps.Size(34,49),new google.maps.Point(0,0));google.visualization.events.addListener(e,"onmouseover",function(b){null==chartMarker?chartMarker=new google.maps.Marker({position:a[b.row].location,map:map,icon:sMarkerImage}):chartMarker.setPosition(a[b.row].location)})}}}
function centerMap(a){geocoder.geocode({address:a},function(a,d){d==google.maps.GeocoderStatus.OK&&map.setCenter(a[0].geometry.location)})}function updateCommentsNum(a){var b=parseFloat($("#comments-container h3").html().split(" ")[0]);console.log(b);$("#comments-container h3").html(b+a+" "+$("#comments-container h3").html().split(" ")[1]);$("#show-comments").html("Komentarze ("+(b+a)+")")}
function updateWorkoutsNum(a){var b=parseFloat($("#workouts-container h3").html().split("(")[1].replace(")",""));$("#workouts-container h3").html("Przejazdy ("+(a+b)+")");$("#show-workouts").html("Przejazdy ("+(a+b)+")")}
function update_rating(a,b){$(b).removeClass("full-fill");$(b).removeClass("half-fill");4.75<a?$(b+":lt(5)").addClass("full-fill"):4.25<a?($(b+":lt(4)").addClass("full-fill"),$(b+".5").addClass("half-fill")):3.75<a?$(b+":lt(4)").addClass("full-fill"):3.25<a?($(b+":lt(3)").addClass("full-fill"),$(b+".4").addClass("half-fill")):2.75<a?$(b+":lt(3)").addClass("full-fill"):2.25<a?($(b+":lt(2)").addClass("full-fill"),$(b+".3").addClass("half-fill")):1.75<a?$(b+":lt(2)").addClass("full-fill"):1.25<a?($(b+
":lt(1)").addClass("full-fill"),$(b+".2").addClass("half-fill")):0.75<a&&$(b+".1").addClass("full-fill")}
function update_index_rating(){$("ul.rating").each(function(a){z=$("ul.rating")[a];value=$(z).children().first().html();4.75<parseFloat(value)?$(z).children().each(function(){$(this).addClass("full-fill")}):4.25<parseFloat(value)?$(z).children().each(function(a){5>a?$(this).addClass("full-fill"):5==a&&$(this).addClass("half-fill")}):3.75<parseFloat(value)?$(z).children().each(function(a){5>a&&$(this).addClass("full-fill")}):3.25<parseFloat(value)?$(z).children().each(function(a){4>a?$(this).addClass("full-fill"):
4==a&&$(this).addClass("half-fill")}):2.75<parseFloat(value)?$(z).children().each(function(a){4>a&&$(this).addClass("full-fill")}):2.25<parseFloat(value)?$(z).children().each(function(a){3>a?$(this).addClass("full-fill"):3==a&&$(this).addClass("half-fill")}):1.75<parseFloat(value)?$(z).children().each(function(a){3>a&&$(this).addClass("full-fill")}):1.25<parseFloat(value)?$(z).children().each(function(a){2>a?$(this).addClass("full-fill"):2==a&&$(this).addClass("half-fill")}):0.75<parseFloat(value)&&
$(z).children().each(function(a){2>a&&$(this).addClass("full-fill")})})};